import{j as m}from"./jsx-runtime-DiklIkkE.js";import{r as B}from"./index-DRjF_FHU.js";import{e as w,f as K,g as E,h as q,j as V,l as W,m as H,n as J,o as D,p as Q,q as U,S as X,r as Y,s as _,t as Z,u as $,v as z,b as k,w as ee,k as ne}from"./_baseEach-B-y44WsN.js";import{a as re,g as te,c as me,d as ae,k as I,i as se,e as ie,f as le,h as oe,j as ue,l as ge,n as ce,o as de,m as v}from"./isString-CNnovG4X.js";import{c as pe}from"./clone-ZfB6SeuH.js";import{i as T}from"./isArray-Dxzbedgu.js";import{O as be}from"./OperationsList-CPVzoTey.js";function ye(e,n,r){if(!w(r))return!1;var a=typeof n;return(a=="number"?K(r)&&E(n,r.length):a=="string"&&n in r)?q(r[n],e):!1}function fe(e){return re(function(n,r){var a=-1,t=r.length,o=t>1?r[t-1]:void 0,i=t>2?r[2]:void 0;for(o=e.length>3&&typeof o=="function"?(t--,o):void 0,i&&ye(r[0],r[1],i)&&(o=t<3?void 0:o,t=1),n=Object(n);++a<t;){var l=r[a];l&&e(n,l,a,o)}return n})}var Se="[object Object]",we=Function.prototype,Te=Object.prototype,P=we.toString,Ae=Te.hasOwnProperty,he=P.call(Object);function ve(e){if(!V(e)||W(e)!=Se)return!1;var n=te(e);if(n===null)return!0;var r=Ae.call(n,"constructor")&&n.constructor;return typeof r=="function"&&r instanceof r&&P.call(r)==he}function C(e,n,r){(r!==void 0&&!q(e[n],r)||r===void 0&&!(n in e))&&me(e,n,r)}function O(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}function Ce(e){return ae(e,I(e))}function Oe(e,n,r,a,t,o,i){var l=O(e,r),u=O(n,r),d=i.get(u);if(d){C(e,r,d);return}var s=o?o(l,u,r+"",e,n,i):void 0,g=s===void 0;if(g){var f=T(u),S=!f&&H(u),y=!f&&!S&&J(u);s=u,f||S||y?T(l)?s=l:se(l)?s=ie(l):S?(g=!1,s=le(u,!0)):y?(g=!1,s=oe(u,!0)):s=[]:ve(u)||D(u)?(s=l,D(l)?s=Ce(l):(!w(l)||Q(l))&&(s=ue(u))):g=!1}g&&(i.set(u,s),t(s,u,a,o,i),i.delete(u)),C(e,r,s)}function N(e,n,r,a,t){e!==n&&U(n,function(o,i){if(t||(t=new X),w(o))Oe(e,n,i,r,N,a,t);else{var l=a?a(O(e,i),o,i+"",e,n,t):void 0;l===void 0&&(l=o),C(e,i,l)}},I)}function xe(e,n){return Y(e,n)}var j=fe(function(e,n,r){N(e,n,r)});function Re(e,n,r,a){if(!w(e))return e;n=_(n,e);for(var t=-1,o=n.length,i=o-1,l=e;l!=null&&++t<o;){var u=Z(n[t]),d=r;if(u==="__proto__"||u==="constructor"||u==="prototype")return e;if(t!=i){var s=l[u];d=void 0,d===void 0&&(d=w(s)?s:E(n[t+1])?[]:{})}ge(l,u,d),l=l[u]}return e}function De(e,n,r){for(var a=-1,t=n.length,o={};++a<t;){var i=n[a],l=$(e,i);r(l,i)&&Re(o,_(i,e),l)}return o}function je(e,n){if(e==null)return{};var r=z(ce(e),function(a){return[a]});return n=k(n),De(e,r,function(a,t){return n(a,t[0])})}function Ee(e,n,r){return e.map(a=>a===n?r:a)}function qe(e,n,r){return e.map((a,t)=>t===n?r:a)}function _e(e,n,r){const a=pe(e);return a[n]=r,a}const Ie=(e,n=[])=>je(e,r=>![null,void 0,...n].includes(r)),G=({command:e,setCommand:n,columns:r,commandPatterns:a})=>{if(e===void 0)return m.jsx("span",{});const t=e[0].symbol,o=a[t];if(T(o)){if(xe(o,[null]))return m.jsx("div",{className:"operation-detail"});{const i=o;return m.jsx("div",{className:"operation-detail",children:m.jsx(F,{command:e,fullPattern:i,setCommand:n,columns:r})})}}else return m.jsxs("h2",{children:["unknown command ",t]})},F=({command:e,fullPattern:n,setCommand:r,columns:a})=>{const t=o=>{const i=o[0],l=e[i],u=d=>{const s=qe(e,i,d);r(s)};return m.jsx("div",{children:m.jsx(Pe,{argProps:o,renderKey:i,val:l,setter:u,columns:a})},i)};return m.jsx("div",{className:"arg-getters",children:n.map(t)})},Pe=({argProps:e,val:n,setter:r,columns:a,renderKey:t})=>{const[o,i,l,u]=e,d=s=>r(s.target.value);if(l==="enum"&&T(u))return m.jsxs("fieldset",{children:[m.jsxs("label",{children:[" ",i," "]}),m.jsx("select",{defaultValue:n,onChange:d,children:u.map(s=>m.jsx("option",{value:s,children:s},s))})]},t);if(l==="type")if(u==="integer"){const s=g=>r(parseInt(g.target.value));return m.jsxs("fieldset",{children:[m.jsxs("label",{children:[" ",i," "]}),m.jsx("input",{type:"number",defaultValue:n,step:"1",onChange:s})]},t)}else if(u==="float"){const s=g=>r(parseFloat(g.target.value));return m.jsxs("fieldset",{children:[m.jsxs("label",{children:[" ",i," "]}),m.jsx("input",{type:"number",step:"0.01",defaultValue:n,onChange:s})]},t)}else if(u==="string"){const s=g=>r(g.target.value);return m.jsxs("fieldset",{children:[m.jsxs("label",{children:[" ",i," "]}),m.jsx("input",{type:"text",defaultValue:n,onChange:s})]},t)}else return m.jsxs("fieldset",{children:[m.jsxs("label",{children:[" ",i," "]}),m.jsx("input",{value:"dont know"})]},t);else if(l==="colEnum"){const s=a.map(g=>{const f=y=>{const A=y.target.value;if(de(A)){const h=_e(n,g,A);r(Ie(h,["null"]))}},S=ee(n,g,"null");return T(u)?m.jsx("td",{children:m.jsx("select",{defaultValue:S,onChange:f,children:u.map(y=>m.jsx("option",{value:y,children:y},y))})},t+g):m.jsx("h3",{children:" arg error"})});return m.jsx("div",{className:"col-enum",children:m.jsxs("table",{children:[m.jsx("thead",{children:m.jsx("tr",{children:a.map(g=>m.jsx("th",{children:g},g))})}),m.jsx("tbody",{children:m.jsx("tr",{children:s})})]})},t)}else return m.jsx("h3",{children:" unknown argtype "})};G.__docgenInfo={description:"",methods:[],displayName:"OperationDetail",props:{command:{required:!0,tsType:{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]},description:""},setCommand:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCommand: Operation) => void",signature:{arguments:[{type:{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]},name:"newCommand"}],return:{name:"void"}}},description:""},columns:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},commandPatterns:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"Array",elements:[{name:"union",raw:"TypeSpec | EnumSpec | ColEnumSpec | NoArgs",elements:[{name:"tuple",raw:'[number, string, "type", "integer" | "float" | "string"]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"type"'},{name:"union",raw:'"integer" | "float" | "string"',elements:[{name:"literal",value:'"integer"'},{name:"literal",value:'"float"'},{name:"literal",value:'"string"'}]}]},{name:"tuple",raw:'[number, string, "enum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"enum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},{name:"tuple",raw:'[number, string, "colEnum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"colEnum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},{name:"null"}]}],raw:"ArgSpec[]"}],raw:"Record<string, ArgSpec[]>"},description:""}}};F.__docgenInfo={description:"",methods:[],displayName:"ArgGetters",props:{command:{required:!0,tsType:{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]},description:""},fullPattern:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"TypeSpec | EnumSpec | ColEnumSpec",elements:[{name:"tuple",raw:'[number, string, "type", "integer" | "float" | "string"]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"type"'},{name:"union",raw:'"integer" | "float" | "string"',elements:[{name:"literal",value:'"integer"'},{name:"literal",value:'"float"'},{name:"literal",value:'"string"'}]}]},{name:"tuple",raw:'[number, string, "enum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"enum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},{name:"tuple",raw:'[number, string, "colEnum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"colEnum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]}]}],raw:"ActualArg[]"},description:""},setCommand:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCommand: Operation) => void",signature:{arguments:[{type:{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]},name:"newCommand"}],return:{name:"void"}}},description:""},columns:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""}}};const L=({column:e,addOperationCb:n,defaultArgs:r})=>{const a=t=>()=>{const o=r[t];n(Ee(o,"col",e))};return m.jsxs("div",{className:"operation-adder",children:[m.jsxs("span",{className:"column-name",children:[" Column: ",e]}),m.jsx("fieldset",{children:ne(r).map(t=>m.jsxs("button",{onClick:a(t),children:[" ",t," "]},t))})]})},Ne=({operations:e,setOperations:n,activeColumn:r,allColumns:a,command_config:t})=>{const o=(p,c)=>c[0].symbol+p.toString(),i=v(Array.from(e.entries()),([p,c])=>{const b={};return b[o(p,c)]=c,b}),l=j({},...i),u=v(Array.from(e.entries()),([p,c])=>{const b={};return b[o(p,c)]=p,b}),d=j({},...u),[s,g]=B.useState("");function f(p){return c=>{const b=d[p],x=e.map((R,M)=>M===b?c:R);console.log("about to call setOperations",p,c),n(x)}}const S=p=>v(Array.from(p.entries()),([c,b])=>b[0].symbol+c.toString()),y=p=>{const c=[...e,p];n(c);const b=S(c)[c.length-1];b!==void 0&&g(b)},{argspecs:A,defaultArgs:h}=t;return m.jsxs("div",{className:"operations-viewer",children:[m.jsx(L,{column:r,addOperationCb:y,defaultArgs:h}),m.jsxs("div",{className:"operations-box",children:[m.jsx("h4",{children:" Operations "}),m.jsx(be,{operations:e,activeKey:s,setActiveKey:g,setOperations:n})]}),s&&m.jsx(G,{command:l[s],setCommand:f(s),columns:a,commandPatterns:A})]})};L.__docgenInfo={description:"",methods:[],displayName:"OperationAdder",props:{column:{required:!0,tsType:{name:"string"},description:""},addOperationCb:{required:!0,tsType:{name:"any"},description:""},defaultArgs:{required:!0,tsType:{name:"any"},description:""}}};Ne.__docgenInfo={description:"",methods:[],displayName:"OperationViewer",props:{operations:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]}],raw:"Operation[]"},description:""},setOperations:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCommands: Operation[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]}],raw:"Operation[]"},name:"newCommands"}],return:{name:"void"}}},description:""},activeColumn:{required:!0,tsType:{name:"string"},description:""},allColumns:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},command_config:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    argspecs: CommandArgSpec;
    defaultArgs: OperationDefaultArgs;
}`,signature:{properties:[{key:"argspecs",value:{name:"Record",elements:[{name:"string"},{name:"Array",elements:[{name:"union",raw:"TypeSpec | EnumSpec | ColEnumSpec | NoArgs",elements:[{name:"tuple",raw:'[number, string, "type", "integer" | "float" | "string"]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"type"'},{name:"union",raw:'"integer" | "float" | "string"',elements:[{name:"literal",value:'"integer"'},{name:"literal",value:'"float"'},{name:"literal",value:'"string"'}]}]},{name:"tuple",raw:'[number, string, "enum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"enum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},{name:"tuple",raw:'[number, string, "colEnum", string[]]',elements:[{name:"number"},{name:"string"},{name:"literal",value:'"colEnum"'},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},{name:"null"}]}],raw:"ArgSpec[]"}],raw:"Record<string, ArgSpec[]>",required:!0}},{key:"defaultArgs",value:{name:"Record",elements:[{name:"string"},{name:"union",raw:"OperationSingleColumn | OperationSingleArg | OperationTwoArg",elements:[{name:"tuple",raw:"[SymbolT, SymbolDf, string]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]},{name:"tuple",raw:"[SymbolT, SymbolDf, string, Atom, Atom]",elements:[{name:"SymbolT"},{name:"SymbolDf"},{name:"string"},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]},{name:"union",raw:"number | string | SymbolT | ColEnumArgs",elements:[{name:"number"},{name:"string"},{name:"SymbolT"},{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}]}]}]}],raw:"Record<string, Operation>",required:!0}}]}},description:""}}};export{Ne as O};
